# FAQ

## ç´¢å¼•
* HyperApp é—®é¢˜
    * å…³äºŽå›½åŒºè¢«ä¸‹æž¶çš„è§£å†³æ–¹æ³•
    * å¦‚ä½•ç”³è¯· TF
    * å¦‚ä½•å‡çº§åº”ç”¨
    * å¸¸è§å®‰è£…é”™è¯¯
    * æœåŠ¡å™¨é”™è¯¯
* åº”ç”¨é—®é¢˜
    * æ–‡ä»¶ä¸Šä¼ å¤§å°é™åˆ¶
    * nextcloudå®‰è£…é—®é¢˜
    * wordpress éœ€è¦æä¾›ftpå‡­æ®
    * ç½‘é¡µæ— æ³•è®¿é—® (502,503)
* çˆ±å›½é—®é¢˜
    * æ‰‹æœºçˆ±å›½ç”µè„‘ä¸çˆ±å›½
    * æ— æ³•çˆ±å›½çš„é—®é¢˜
* ç³»ç»Ÿé—®é¢˜
    * å¦‚ä½•æ‰‹åŠ¨å¼€å¯ BBR
* [GCP é—®é¢˜](#gcp)
    * [ç»“ç®—è´¦å·è¢«åœç”¨](proxy/get-started.md)
    * [å¯†é’¥è®¤è¯å¤±è´¥](proxy/get-started.md)


## HyperApp å¸¸è§é—®é¢˜

### å…³äºŽå›½åŒºè¢«ä¸‹æž¶çš„é—®é¢˜

1. ã€Œæ¢åŒºã€ä¸´æ—¶çš„ä¸‹è½½&æ›´æ–°æ–¹æ¡ˆæ˜¯å°†è‡ªå·±è´¦å·æ¢åŒºï¼Œæ¯”å¦‚åŠ æ‹¿å¤§åŒºï¼ˆä¸éœ€è¦ç»‘å®šæ”¯ä»˜æ–¹å¼ï¼‰ï¼Œç„¶åŽç‚¹å‡»è´­ä¹°å³å¯ï¼ˆä¸éœ€è¦å†æ¬¡ä»˜è´¹ï¼‰ã€‚
2. ã€ŒTestFlightã€åœ¨å›½åŒºè´­ä¹°çš„ç”¨æˆ·å¯ä»¥å°†ã€ŒApple æä¾›çš„æ”¶æ®ã€ï¼ˆå¿…éœ€ï¼‰å’Œé‚®ç®±å‘ç»™æˆ‘åŠ å…¥ TFï¼Œä¸æ¢åŒºä¹Ÿèƒ½ä¸€ç›´ä¿æŒæ›´æ–°ã€‚é‚®ä»¶å‘é€è‡³ HyperAppCloudðŸŒ€gmail.com
3. iMazing å…è´¹ç‰ˆå°±å¯ä»¥å®‰è£…å·²ä¸‹æž¶çš„åº”ç”¨ï¼Œæ˜¯ç›®å‰æœ€ç®€å•çš„åŠžæ³•ï¼Œæœç´¢å³å¯ã€‚


### å¦‚ä½•ç”³è¯· TF

åœ¨ `App` é‡Œé¢ç‚¹å‡» `å‘é€åé¦ˆé‚®ä»¶` å°†ä¸»é¢˜æ”¹ä¸º `ç”³è¯· TF` å¹¶ä¸”é™„ä¸Šè´­ä¹°æ”¶æ®å³å¯ã€‚


### å¦‚ä½•å‡çº§åº”ç”¨ï¼Ÿ

1. åœ¨æœåŠ¡å™¨ä¸‹é¢çš„ Docker ç›‘æŽ§é‡Œé€‰æ‹©ä½ çš„åº”ç”¨ï¼Œè½»ç‚¹åŽé€‰æ‹© `Pull Image` å³å¯æ›´æ–°é•œåƒï¼Œç„¶åŽåœ¨åº”ç”¨é‚£é‡Œ `æ›´æ–°é…ç½®`
2. æ‰‹åŠ¨çš„è¯å¯ä»¥ `docker ps` æ‰¾åˆ°åº”ç”¨çš„é•œåƒåå­—ï¼Œç„¶åŽ `docker pull é•œåƒ`ï¼Œç„¶åŽåœ¨åº”ç”¨é‚£é‡Œ `æ›´æ–°é…ç½®`


### å®‰è£…é”™è¯¯


#### å®‰è£…åº”ç”¨æ—¶æŠ¥é”™ "i686 not recognized platform"

* ç³»ç»Ÿå¿…é¡»æ˜¯64ä½(X86-64)Linuxç³»ç»Ÿ
* è™šæ‹ŸåŒ–æ–¹å¼ä¸æ”¯æŒ OpenVZ


#### Bind for *** failed:port is already allocated.

ç«¯å£é‡å¤äº†ï¼Œä¸åŒçš„åº”ç”¨ã€è¿›ç¨‹ä¸èƒ½ä½¿ç”¨åŒä¸€ä¸ªç«¯å£


#### ä¸ºä»€ä¹ˆåœ¨å®‰è£…åº”ç”¨çš„æ—¶å€™.ä¼šå¡åœ¨å®‰è£…ä¸­éžå¸¸ä¹…(è¿™ç§æƒ…å†µå¤šå‡ºçŽ°åœ¨å›½å†…VPSä¸­)ï¼Ÿ

è¯·å…ˆç¡®å®šä½ çš„VPSå¯ä»¥æ­£ç¡®è”ç½‘å†å‚è€ƒä¸‹åˆ—æ­¥éª¤:
* æ–¹æ³•1: åœ¨hyperappç»ˆç«¯å·¦ä¸‹è§’ç¬¬ä¸€ä¸ªæŒ‰é’®ä¸­.é€‰æ‹©å®‰è£…é˜¿é‡Œäº‘å›½å†…Dockeræº
* æ–¹æ³•2: é˜¿é‡Œäº‘ç”¨æˆ·è¯·å‚è€ƒ[ä½¿ç”¨é˜¿é‡Œäº‘é•œåƒåŠ é€ŸæœåŠ¡](Aliyun-docker.md)
* ç»ˆæžè§£å†³åŠžæ³•: è¿œç¦»å›½å†…VPS.
* å¦‚æžœä½ ä½¿ç”¨çš„å›½å¤– VPS ä¾ç„¶éžå¸¸æ…¢ï¼Œé‚£ä¼°è®¡æ˜¯ä½ VPSçš„ç½‘ç»œæ¯”è¾ƒæ…¢ï¼Œæœ‰äº›åº”ç”¨çš„é•œåƒå¾ˆå¤§ï¼Œä¸‹è½½éœ€è¦æ—¶é—´ã€‚


#### æç¤ºè¿žæŽ¥å¤±è´¥/æ— æ³•è¿žæŽ¥

1. è¯·ä¸è¦æ‰“å¼€VPNè¿žæŽ¥hyperapp.ï¼ˆæˆ–è€…åœ¨å¯¹åº”çš„Appä¸­åŠ ä¸€æ¡è§„åˆ™ï¼Œè®¾ç½®ä½ çš„æœåŠ¡å™¨IPç›´è¿žï¼‰
2. æ£€æŸ¥æœåŠ¡å™¨IPæ˜¯å¦å˜äº†ï¼ˆGCP å¦‚æžœæ²¡æœ‰ç”¨é™æ€IPï¼ŒæœåŠ¡å™¨å…³æœºåŽå†é‡å¯IPå¯èƒ½ä¼šå˜ï¼‰
3. æ£€æŸ¥SSHç«¯å£æœ‰æ²¡æœ‰å¡«å¯¹ï¼ˆé»˜è®¤22ï¼‰
4. ä¹Ÿè®¸ä½ çš„IPè¢«å¢™äº†


#### æç¤º transport read æˆ–è€… timeout

1. ä¸è¦å¼€ VPN ä½¿ç”¨ HyperAppï¼Œå¹¶ä¸”è¿›è¡Œæ“ä½œçš„æ—¶å€™ä¸è¦åˆ‡æ¢åº”ç”¨.
2. timeout å¯èƒ½æ˜¯æŽ‰çº¿äº†ï¼Œåˆ·æ–°ä¸‹æœåŠ¡å™¨çŠ¶æ€ï¼Œçœ‹çœ‹åº”ç”¨çŠ¶æ€æ˜¯å¦æ”¹å˜ã€‚


#### Conflict

`docker: Error response from daemon: Conflict. The container name *** is already used by container ....`

åº”ç”¨å·²ç»å®‰è£…è¿‡äº†ï¼Œæ›´æ–°äº†é…ç½®è¦ç‚¹å‡»â€œæ›´æ–°é…ç½®â€


#### docker command not found

1. ç¡®ä¿ä½  VPS çš„æ“ä½œç³»ç»Ÿæ”¯æŒ Dockerã€‚
2. HyperApp ä¼šè‡ªåŠ¨å®‰è£… Dockerï¼Œå‡ºçŽ°è¿™ç±»é—®é¢˜å¯èƒ½æ˜¯ Docker å®‰è£…å¤±è´¥ï¼Œä½ å¯ä»¥æ‰‹åŠ¨æ‰§è¡Œ `curl -fsSL get.docker.com | sh` å®‰è£…æœ€æ–°docker


#### cannot connect to the Docker daemon

1. è¯·ç¡®ä¿ä½ çš„ Linux ç‰ˆæœ¬ç¬¦åˆè¦æ±‚
2. è¯·ç¡®ä¿ä¸€å®šè¦å…ˆå®‰è£… BBR å†å®‰è£…åº”ç”¨ï¼Œå¦‚æžœä½ ä¸å¹¸æžé”™äº†é¡ºåºï¼Œå‚è€ƒä¸‹ä¸€æ¡
3. å°è¯•åœ¨ç»ˆç«¯çš„å¿«æ·å‘½ä»¤ä¸­ç‚¹å‡» `Start Docker` æ‰‹åŠ¨å¯åŠ¨ä¸‹ Docker æˆ–è€…å¯åŠ¨ä»»æ„ä¸€ä¸ªåº”ç”¨


#### å¦‚æžœå…ˆå®‰è£…äº†dockerå†å®‰è£…bbrå¯¼è‡´æ— æ³•å¯åŠ¨dockeræ€Žä¹ˆåŠž?

æ‰§è¡Œ `rm -rf /var/lib/docker/aufs` æ¸…é™¤dockerç½‘ç»œé…ç½®.ç„¶åŽé‡æ–°å®‰è£…æ‰€æœ‰åº”ç”¨å³å¯.


#### sudo: no tty present and no askpass program specified

ä½ éœ€è¦ä¿®æ”¹ `sudo` é…ç½®æ–‡ä»¶å…è®¸å½“å‰ç”¨æˆ·æ— å¯†ç è¿è¡Œ `sudo`


#### æ“ä½œDockeræ—¶æç¤ºæƒé™ä¸è¶³(Permission Denied)

åŽŸå› ï¼šå½“å‰ç”¨æˆ·æ²¡æœ‰dockeræƒé™ï¼ŒåŠ åˆ°dockerç»„æ‰æœ‰ï¼Œæ‰§è¡Œå‘½ä»¤


```
sudo usermod -aG docker $USER
```

#### å®‰è£…åº”ç”¨æ—¶å®‰è£…å¤±è´¥æç¤º"overlay"å·²æ»¡

åŽŸå› ï¼šå·²å®‰è£…æˆ–è€…æ›¾ç»å®‰è£…è¿‡çš„åº”ç”¨å¤ªå¤šï¼Œå› ä¸ºDockerè‡ªèº«çš„æœºåˆ¶ï¼Œåˆ é™¤å®¹å™¨å¹¶ä¸ä¼šåˆ é™¤é•œåƒï¼Œä¹…è€Œä¹…ä¹‹ç¡¬ç›˜å¯èƒ½ä¼šè¢«å¡žæ»¡

é¦–å…ˆè¿›å…¥å‘½ä»¤è¡Œï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤æ¥æŸ¥è¯¢å·²å­˜åœ¨çš„é•œåƒ

```
docker image ls
```
ç„¶åŽæ‰¾åˆ°ä¸éœ€è¦çš„æˆ–è€…å ç”¨ä½“ç§¯ç‰¹åˆ«å¤§çš„é•œåƒï¼Œå¤åˆ¶å®ƒçš„"REPOSITORY"æˆ–è€…"IMAGE ID",ç„¶åŽé”®å…¥ä»¥ä¸‹å‘½ä»¤æ¥åˆ é™¤é•œåƒ

```
docker image rm é•œåƒIDæˆ–è€…REPOSITORY
```
åˆ é™¤å®Œæˆä¹‹åŽå¯çœ‹åˆ°ç¡¬ç›˜ç©ºé—´å·²ç»é‡Šæ”¾ï¼Œå¯ä»¥ç»§ç»­å®‰è£…æƒ³è¦çš„åº”ç”¨

#### ä½¿ç”¨bbrå®‰è£…è„šæœ¬çš„æ—¶å€™æç¤º"Inappropriate ioctl for device"
ä½¿ç”¨é”®ç›˜éšä¾¿è¾“å…¥å‡ ä¸ªå­—ç¬¦å¹¶ä¸”å›žè½¦ä¸¤ä¸‹.åŽŸå› æ˜¯bbrå®‰è£…è„šæœ¬éœ€è¦ç­‰å¾…è¾“å…¥æ¥æ‰§è¡Œä¸‹ä¸€æ­¥


##### éƒ¨ç½² Nginx SSL Support æŠ¥é”™æç¤ºæ‰¾ä¸åˆ°/ä¸å­˜åœ¨Nginx Proxy ä½† Nginx å·²ç»æ­£ç¡®å®‰è£…

* å¦‚æžœå°†åŒä¸€ä¸ªåº”ç”¨éƒ¨ç½²åˆ°å¤šä¸ªæœåŠ¡å™¨ï¼Œæœ€å¥½åœ¨å®‰è£…æ—¶ä¸€æ¬¡é€‰æ‹©å¤šä¸ªæœåŠ¡å™¨è€Œä¸è¦å¼€å¯å¤šä¸ªåº”ç”¨ã€‚

æ£€æŸ¥ SSL Support æ˜¯å¦åœ¨åŒä¸€æœºå™¨æœ‰å¯¹åº”çš„Nginx


---


## åº”ç”¨é—®é¢˜

### ç½‘é¡µæ— æ³•è®¿é—®

å¸¸è§åŽŸå› ï¼š

1. å¦‚æžœä½ å¯ç”¨äº† `HTTPS` è¯·ç¨ç­‰ç‰‡åˆ»ï¼ŒSSL Support èŽ·å–è¯ä¹¦éœ€è¦æ—¶é—´ï¼ˆå¤§çº¦å‡ åˆ†é’Ÿï¼‰ã€‚
2. æœ‰äº›åº”ç”¨å®‰è£…åŽä¹Ÿéœ€è¦å‡ åˆ†é’Ÿçš„åˆå§‹åŒ–æ—¶é—´ï¼ˆæ¯”å¦‚æ•°æ®åº“åˆå§‹åŒ–ï¼‰ï¼Œè¯·ç¨ç­‰å‡ åˆ†é’Ÿå†è¯•ã€‚


å¦‚æžœé”™è¯¯ç»§ç»­ï¼Œå‚è€ƒä¸‹é¢è¿‡ç¨‹æŽ’é”™ï¼š

1. åˆ·æ–°æœåŠ¡å™¨çŠ¶æ€ï¼Œç¡®ä¿åº”ç”¨å¤„äºŽ `running` çŠ¶æ€ã€‚
2. å¦‚æžœä¸åœ¨è¿è¡Œä¸­çš„çŠ¶æ€ï¼Œè¯´æ˜Žå®‰è£…åŽçš„åˆå§‹åŒ–æ²¡æœ‰æˆåŠŸï¼ŒæŸ¥çœ‹åº”ç”¨æ—¥å¿—å¯ä»¥çœ‹åˆ°å‡ºé”™åŽŸå› ã€‚
3. å¦‚æžœä½ è¦å¯»æ±‚å¸®åŠ©ï¼Œè¯·å‘å‡ºæ­¤å¤„çš„æ—¥å¿—æˆªå›¾ï¼Œä¸”è¦è´´å…¨ã€‚

### å…³äºŽ Nginx çš„ä¸Šä¼ é™åˆ¶

å¦‚æžœä½ ä½¿ç”¨äº† `Nginx Proxy`ï¼Œåˆ™é»˜è®¤æœ‰ä¸ª2Mçš„ä¸Šä¼ é™åˆ¶ï¼Œä½ å¯ä»¥æ–°å»ºä¸€ä¸ªæ–‡ä»¶ `/srv/docker/nginx/vhost.d/default` æ·»åŠ ä¸€è¡Œ  `client_max_body_size 100m;` æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ Nginx ä¼šè‡ªåŠ¨é‡å¯ï¼Œå¦‚æžœæ²¡æœ‰åˆ™éœ€è¦æ‰‹åŠ¨é‡å¯ä¸‹ Nginx Proxyï¼‰

ä½ ä¹Ÿå¯ä»¥ç›´æŽ¥è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸Šé¢çš„æ‰€è¯´çš„æ–‡ä»¶:

```sh
echo "client_max_body_size 100m;" > /srv/docker/nginx/vhost.d/default
```
å¦‚æžœåŽŸæ–¹æ¡ˆä¸è¡Œï¼Œå°è¯•ä»¥ä¸‹ä¸¤ç§æ–¹æ¡ˆï¼š
1. ```echo "client_max_body_size 100m;" | sudo tee -a /srv/docker/nginx/vhost.d/default```
2. ```sudo su echo "client_max_body_size 100m;" > /srv/docker/nginx/vhost.d/default```

ä»¥ä¸Šä»»é€‰ä¸€ç§æ‰§è¡ŒåŽï¼Œæ‰‹åŠ¨é‡å¯nginx

**é™¤äº† Nginx å¤–ï¼ŒPHP è¿˜å¯ä»¥æœ‰è‡ªå·±çš„ä¸Šä¼ é™åˆ¶ï¼Œè¯·å‚è€ƒ https://github.com/waylybaye/HyperApp-Guide/issues/152**


### nextcloud å®‰è£…é—®é¢˜

1. è®¾ç½®æ•°æ®åº“æ—¶,å¡«å…¥æ•°æ®åº“çš„è´¦å·å¯†ç ä¹‹åŽ,æç¤ºauthenticationå‡ºçŽ°é—®é¢˜,æ— æ³•è®¤è¯
   è¿™æ˜¯MySQLçš„æ–°ç‰ˆæœ¬æ›´æ–°äº†éªŒè¯æ–¹å¼,æ¯”è¾ƒç®€å•çš„æ–¹å¼æ˜¯åœ¨å®‰è£…mysqlæ—¶,æ‰‹åŠ¨é€‰æ‹©`5.x`ç‰ˆæœ¬çš„é•œåƒ,ä¸è¦é€‰æ‹©`latest`,å¦ä¸€ä¸ªæ–¹æ¡ˆæ˜¯ä½¿ç”¨Mariadb,ä¸¤è€…åœ¨åŽç»­æ“ä½œä¸Šæ²¡æœ‰åŒºåˆ«

2. è¿›è¡Œå®‰å…¨æ£€æŸ¥æ—¶,æç¤ºæ²¡æœ‰è®¾ç½®`referer`
   è§£å†³æ–¹æ³•å‚è€ƒæ›´æ”¹nginxçš„é»˜è®¤ä¸Šä¼ å¤§å°,åœ¨``` srv/docker/nginx/vhost.d/```ç›®å½•ä¸‹,æ–°å»ºä¸€ä¸ªæ–‡ä»¶,æ–‡ä»¶åä¸ºä½ ä¸ºnextcloudåˆ†é…çš„åŸŸå(è¦å®Œæ•´),åœ¨é‡Œé¢åŠ å…¥ä¸¤æ¡è®°å½•```add_header Referrer-Policy no-referrer;client_max_body_size 500m;``` ,ä½ å¯ä»¥ä½¿ç”¨ ```echo "add_header Referrer-Policy no-referrer;client_max_body_size 500m;" >> /srv/docker/nginx/vhost.d/ä½ çš„åŸŸå```
   
### wordpress æç¤ºè®¾ç½®ftp

åœ¨è‡ªåŠ¨æ›´æ–°wordpressæ–°ç‰ˆæœ¬æ—¶,æç¤ºå¡«å…¥ftpå‡­æ®,è¿™æ˜¯ç”±äºŽåœ¨é…ç½®wordpressçš„è¿‡ç¨‹ä¸­æ–‡ä»¶æ²¡æœ‰å†™æƒé™é€ æˆçš„,æ‰€ä»¥éœ€è¦é‡æ–°æ›´æ”¹æƒé™.æŸ¥è¯¢ä¸€ä¸‹wordpressçš„container name,ç„¶åŽæ‰§è¡Œ ```docker exec CONTAINER_NAME chown -R www-data:www-data /var/www/html```,`CONTAINER_NAME`å¡«å†™ä½ æŸ¥è¯¢åˆ°çš„ç»“æžœ,å…·ä½“å‚è€ƒ[è¿™é‡Œ](https://github.com/docker-library/wordpress/issues/24).

## çˆ±å›½é—®é¢˜

### æ‰‹æœºå¯ä»¥ç”µè„‘ä¸è¡Œï¼š
è¯·å…ˆæŸ¥çœ‹å®¢æˆ·ç«¯æ—¥å¿—ï¼Œå¹¶è´´å‡ºæ¥ç”¨å…¨å±€æ¨¡å¼æµ‹éžChromeã€Firefoxæµè§ˆå™¨ï¼ˆå› ä¸ºChromeæµè§ˆå™¨çš„å¾ˆå¤šæ’ä»¶ä¼šæ”¹ä»£ç†è®¾ç½®ï¼‰å¦‚æžœå…¨å±€å¯ä»¥å°±èƒ½æ–­å®šæ˜¯pacè§„åˆ™æˆ–è€…æµè§ˆå™¨çš„åŽŸå› ã€‚


### æ— æ³•ç§‘å­¦ä¸Šç½‘çš„é—®é¢˜

#### æŽ’æŸ¥æœåŠ¡ç«¯çš„é—®é¢˜

1. HyperApp é‡Œé¢åˆ·æ–°ä¸€ä¸‹æœåŠ¡å™¨çŠ¶æ€ï¼Œçœ‹åº”ç”¨æ˜¯å¦å¯åŠ¨æˆåŠŸ(æ˜¾ç¤º up xxx seconds/minutes/hours)
2. ç‚¹å‡» `æŸ¥çœ‹æ—¥å¿—` çœ‹çœ‹åº”ç”¨æ—¥å¿—ä¸­æ˜¯å¦æœ‰é”™è¯¯æç¤º
    * ss-libev å¦‚æžœæœ‰ä¸€äº›è¿žæŽ¥é”™è¯¯çš„ä¿¡å¿ƒï¼Œä¸€èˆ¬æ˜¯å®¢æˆ·ç«¯çš„å¯†ç ã€åŠ å¯†æ–¹å¼ã€æ··æ·†æ²¡å¡«å¯¹ã€‚
3. å¦‚æžœä¸Šä¸¤æ­¥éƒ½æ²¡æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥
    * æ˜¯å¦æ˜¯æœºå™¨é˜²ç«å¢™é—®é¢˜ï¼ˆå‚è€ƒä¸‹é¢çš„ç¬¬äºŒé¡¹ï¼‰
    * æ˜¯å¦æ˜¯å®¢æˆ·ç«¯é…ç½®é”™è¯¯ï¼ˆå‚è€ƒä¸‹é¢çš„å®¢æˆ·ç«¯æŽ’é”™ï¼‰

#### æŽ’æŸ¥å®¢æˆ·ç«¯çš„é—®é¢˜

* æ˜¯å¦ä½¿ç”¨äº†è·ŸæœåŠ¡ç«¯ä¸€è‡´çš„é…ç½®ã€‚å»ºè®®é€šè¿‡æ‰«æäºŒç»´ç çš„æ–¹å¼æ·»åŠ ã€‚
* å¦‚æžœä½ ç”¨ Wingy ä¸è¦å¼€ OBFS ï¼ˆé™¤éžä½ è‡ªå·±è¶³å¤Ÿäº†è§£ï¼‰
* å¦å¤–ä¸è¦ç”¨ SSR è¿ž SSï¼Œä¹Ÿä¸è¦ç”¨ SS è¿ž SSR
* ss-libev å®¢æˆ·ç«¯çš„ http/tls æ··æ·†å¿…é¡»è¦å’ŒæœåŠ¡ç«¯ä¸€è‡´ã€‚ï¼ˆæœåŠ¡å™¨å¦‚æžœè®¾ç½®çš„ tls æ··æ·†ï¼Œå®¢æˆ·ç«¯ä¹Ÿå¿…é¡»ç”¨ tlsï¼‰
* æœ€åŽå¦‚æžœä½ çš„é—®é¢˜ä¸åœ¨ä¸Šè¿°æ€è·¯ä¸­.è¯·ä»”ç»†æŸ¥çœ‹æ–‡ç« ä¸­æ¶µç›–çš„hyperappå¸¸è§é—®é¢˜ä»¥åŠè§£å†³æ–¹æ¡ˆ.å®žåœ¨æžä¸æ‡‚å†ä¸Šç¾¤æé—®å¹¶ä¸”è¯·æ³¨æ„ä½ çš„è¯­æ°”.æ²¡æœ‰äººæœ‰ä¹‰åŠ¡å¸®åŠ©ä½ .

### å¦‚ä½•æŽ’æŸ¥æœåŠ¡å™¨æ˜¯å¦æœ‰é˜²ç«å¢™é˜»æ‹¦äº†æŸä¸ªç«¯å£ï¼Ÿ

1. åœ¨ VPS ä¸Šè¿è¡Œ: `telnet localhost PORT(è¦æ£€æŸ¥çš„ç«¯å£)` èƒ½é€šè¯´æ˜ŽæœåŠ¡ç«¯æ²¡é—®é¢˜ã€‚ä¸é€šè¯´æ˜ŽæœåŠ¡ç«¯å¯åŠ¨å¤±è´¥ã€‚
2. åœ¨ç”µè„‘ä¸Šè¿è¡Œ`telnet IP PORT(è¦æ£€æŸ¥çš„ç«¯å£)` èƒ½é€šè¯´æ˜Žé˜²ç«å¢™æ²¡é—®é¢˜ã€‚ä¸é€šè¯´æ˜Žæ˜¯é˜²ç«å¢™çš„é—®é¢˜ã€‚
3. åœ¨ VPS ä¸Šè¿è¡Œ `lsof -i :ç«¯å£` æ¥æŸ¥çœ‹æ˜¯å¦æœ‰è¿›ç¨‹æ­£åœ¨ç›‘å¬è¯¥ç«¯å£ï¼Œå¦‚æžœæœ‰è¯´æ˜Žæ˜¯é˜²ç«å¢™å±è”½äº†ç«¯å£è®¿é—®ï¼Œå¦‚æžœæ²¡æœ‰è¯´æ˜Žéƒ¨ç½²å¤±è´¥ã€‚


## é˜²ç«å¢™è®¾ç½®æ•™ç¨‹

* ä¸´æ—¶ç¦ç”¨ç³»ç»Ÿé˜²ç«å¢™
  * CentOS7: service firewalld stop
  * CentOS6: service iptables stop
  * Ubuntu16: service ufw stop
* æ°¸ä¹…ç¦ç”¨ç³»ç»Ÿé˜²ç«å¢™
  * CentOS7: systemctl disable firewalld
  * Ubuntu16: systemctl disable ufw
* ç³»ç»Ÿé˜²ç«å¢™æ°¸ä¹…æ·»åŠ ç«¯å£
  * CentOS7: firewall-cmd --permanent --zone=public --add-port=ç«¯å£/tcp
* å¹³å°é˜²ç«å¢™
  * GCE: ç½‘ç»œ â†’ é˜²ç«å¢™è§„åˆ™
    * ç‚¹å‡»`åˆ›å»ºé˜²ç«å¢™è§„åˆ™`
      * åç§°ï¼šéšä¾¿è¾“å…¥ä¸€ä¸ªåç§°
      * ç›®æ ‡ï¼šé€‰æ‹© `ç½‘ç»œä¸­çš„æ‰€æœ‰ç¤ºä¾‹`
      * æ¥æºè¿‡æ»¤ï¼š`0.0.0.0/0`
      * åè®®å’Œç«¯å£ï¼š`æŒ‡å®šçš„åè®®å’Œç«¯å£` ä¸‹é¢è¾“å…¥ `tcp;udp:ç«¯å£å·`
  * AWS: EC2 æŽ§åˆ¶é¢æ¿ â†’ å®‰å…¨ç»„
  * é˜¿é‡Œäº‘: äº‘æœåŠ¡å™¨ ECS â†’ å®‰å…¨ç»„

----


## ç³»ç»Ÿé—®é¢˜

### å¦‚ä½•æ‰‹åŠ¨å¼€å¯ BBR

æ³¨æ„ä»¥ä¸‹å‘½ä»¤éœ€è¦ `root` æƒé™ï¼Œéž root ç”¨æˆ·å…ˆæ‰§è¡Œ `sudo su -` åˆ‡æ¢åˆ° root è´¦æˆ·

1. è¿è¡Œ `uname -r` çœ‹çœ‹æ˜¯ä¸æ˜¯å†…æ ¸ >= 4.9ï¼Œä¸æ˜¯çš„è¯è¯·å…ˆå‡çº§å†…æ ¸
2. æ‰§è¡Œ `lsmod | grep bbr`ï¼ŒæŸ¥çœ‹ BBR æ¨¡å—æ˜¯å¦å¯ç”¨ï¼Œå¦‚æžœç»“æžœä¸­æ²¡æœ‰ tcp_bbr çš„è¯å°±å…ˆæ‰§è¡Œ
    ```sh
    modprobe tcp_bbr
    echo "tcp_bbr" >> /etc/modules-load.d/modules.conf
    ```
3. æ‰§è¡Œä¸‹å‘½ä»¤å¼€å¯è®¾ç½® TCP ä½¿ç”¨ BBR å‘åŒ…
    ```sh
    echo "net.core.default_qdisc=fq" >> /etc/sysctl.conf
    echo "net.ipv4.tcp_congestion_control=bbr" >> /etc/sysctl.conf
    ```
4. ä¿å­˜ç”Ÿæ•ˆ `sysctl -p`


### éªŒè¯ BBR æ˜¯å¦å·²ç»å¯ç”¨

```sh
sysctl net.ipv4.tcp_available_congestion_control
sysctl net.ipv4.tcp_congestion_control
```

å¦‚æžœç»“æžœéƒ½æœ‰bbr, åˆ™è¯æ˜Žä½ çš„å†…æ ¸å·²å¼€å¯bbr

----

## GCP é—®é¢˜

### äºŒç»´ç æ˜¾ç¤ºä¸å…¨ï¼Œå¦‚ä½•æ‰‹åŠ¨æ·»åŠ  GCP ï¼Ÿ

1. äºŒç»´ç ä¸Šé¢æœ‰ `IP`ï¼Œ`ç”¨æˆ·å`ï¼Œ`ç«¯å£` ä¿¡æ¯ï¼Œåœ¨ `HyperApp â†’ æœåŠ¡å™¨` ä¸­ç‚¹å‡»æ·»åŠ æŒ‰é’®ï¼Œé€‰æ‹©æ‰‹åŠ¨é…ç½®ã€‚
2. åœ¨å‡ºçŽ°çš„çª—å£ä¸­ï¼Œåˆ†åˆ«è¾“å…¥ä¸Šé¢å¯¹åº”çš„å­—æ®µï¼Œå¯†ç ä¸å¡«å†™ï¼Œåœ¨æœ€ä¸‹é¢çš„å¯†é’¥é‚£é‡Œé€‰æ‹©ä¸€ä¸ªå¯†é’¥ï¼ˆåº”è¯¥åªæœ‰ä¸€ä¸ªï¼‰ã€‚
3. æ·»åŠ å³å¯ã€‚ä½†æ˜¯ç¨åŽçš„å¯èƒ½ä¼šå‡ºçŽ°å¯†é’¥è®¤è¯å¤±è´¥çš„é”™è¯¯ï¼Œæ‰€ä»¥å»ºè®®å°†å¯†é’¥åå­—æ”¹æˆä½ çš„ gmail é‚®ç®±åå­—ã€‚æˆ–è€…æŒ‰ç…§æ•™ç¨‹ï¼Œä¿®æ”¹ä¸¤å¤„ç”¨æˆ·åä¸€è‡´å³å¯ã€‚

## åŽ‚å•†å¸¸è§é—®é¢˜ï¼š

* æ¬ç“¦å·¥åªæ”¯æŒ KVMè™šæ‹ŸåŒ– çš„æœºå™¨ã€‚
* Vultr/DigitalOcean/AWS å…¨éƒ½æ”¯æŒ
* GCPæ²¡æœ‰é¢†åˆ°è¯•ç”¨é‡‘ï¼šé‡æ–°æ‰“å¼€è¯•ç”¨é¡µé¢å†ç‚¹å‡»ä¸€æ¬¡â€œTry it freeâ€
* 50Kvm çš„æœºå™¨ç¬¬ä¸€æ¬¡ç™»å½•éœ€è¦è®°ä¸‹ä¸‹æ¬¡ç™»å½•çš„ SSH ç«¯å£
* DigitalOcean çš„æœºå™¨ç¬¬ä¸€æ¬¡ç™»å½•éœ€è¦æ”¹å¯†ç 


----

## å…¶å®ƒå¸¸è§é—®é¢˜:

###  å…³äºŽsquidå†…å­˜ä¸è¶³æ— æ³•æ­£ç¡®å¯åŠ¨çš„è§£å†³åŠžæ³•:

1. Ubuntuä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åˆ›å»ºswap:

```bash
sudo su
fallocate -l 1G /swapfile
chmod 600 /swapfile
mkswap /swapfile
swapon /swapfile
cp /etc/fstab /etc/fstab.bak
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab
echo "vm.swappiness = 10" Â» /etc/sysctl.conf
sysctl -p
```

2. Centosè¯·å°†ç¬¬ä¸€ä¸ªechoæ¢æˆ
  `echo "/swapfile swap swap defaults 0 0" | sudo tee -a /etc/fstab`

### V2rayä¸èƒ½è¿žæŽ¥æŽ’æŸ¥

é’ˆå¯¹æ•™ç¨‹ï¼šV2Rayå®Œç¾Žæ··æ·†æ•™ç¨‹ï¼ˆå†…å«å…¨å¹³å°å®¢æˆ·ç«¯é…ç½®æ•™ç¨‹ï¼‰

* ç¡®å®šå®Œå…¨æŒ‰æ•™ç¨‹æ“ä½œ
  * å¡«å†™ config.jsonæ–°å»ºdockeré»˜è®¤å€¼è¢«é®æŒ¡ï¼Œä¸”ä¸Žæ•™ç¨‹æ‰€ç»™å€¼ä¸ä¸€è‡´ï¼Œéœ€æ›´æ”¹ä¸ºsrv/docker/etc/v2ray.json
  * åº”ç”¨ç«¯å£éœ€æ‰‹åŠ¨å¡«å†™ï¼Œä¸è¦å’Œåˆ«çš„æ•™ç¨‹ä¸€æ ·é»˜è®¤è‡ªåŠ¨æŠ“å–äº†
  * åŸŸåå¡«å†™ä½Žè°ƒä¸€ç‚¹çš„
  * Ubutuä¸ç”¨çœ‹è¿™æ¡ï¼Œcentos7æ³¨æ„å¼€å¯é˜²ç«å¢™ï¼Œæ·»åŠ æ–°ç«¯å£ï¼ˆä½ å¡«çš„portï¼‰ï¼Œå¹¶é‡å¯é˜²ç«å¢™ï¼Œä¸‹é¢å†™ä¸ºyyyï¼Œåœ¨sshä¸­æ‰§è¡Œ
  ```
  firewall-cmd --add-port=yyy/tcp --permanent && firewall-cmd --reload
  ```
  * æ›´æ–°é…ç½®æˆ–å®‰è£…åŽå¯åŠ¨dockerï¼Œæ³¨æ„è¦æ‰‹åŠ¨é‡å¯Nginx proxyå’ŒNginx SSL Support

* å‡ºé”™åŽæ£€æŸ¥æ€è·¯
  * å…ˆæ£€æŸ¥è¯ä¹¦æ˜¯å¦å­˜åœ¨.tlsåŸŸåæ˜¯å¦æ­£å¸¸.ä¼ªè£…åº”ç”¨æ˜¯å¦æ­£å¸¸
  * å†æ£€æŸ¥åŽç«¯v2rayçš„æœåŠ¡ç«¯é…ç½®
  * å†æ£€æŸ¥å®¢æˆ·ç«¯é…ç½®


### å…³äºŽV2Rayè®¿é—®åŸŸåå‡ºçŽ°Bad Requestçš„è§£å†³åŠžæ³•
  å¦‚æžœä½ æŒ‰ç…§æ•™ç¨‹æ­å»ºäº†`Nginx(tls)+V2Ray(websocket)`.é‚£ä¹ˆè®¿é—®è¯ä¹¦åŸŸåçš„æ—¶å€™å¾€å¾€ä¼šå‡ºçŽ°bad requestçš„æƒ…å†µ.è¿™æ˜¯æˆåŠŸçš„æ ‡å¿—.ä½†æ˜¯æ€»ä¸é‚£ä¹ˆå¥½çœ‹.è¿™é‡Œç»™å‡ºä¸€ä¸ªè·³è½¬åˆ°å…¶ä»–åŸŸåçš„åŠžæ³•.æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å³å¯.æ³¨æ„ä¿®æ”¹å‘½ä»¤ä¸­çš„åŸŸå

```sh
echo -e "proxy_intercept_errors on;\nerror_page 400 = https://è¦è·³è½¬åˆ°çš„åŸŸå;" > /srv/docker/nginx/vhost.d/default
```
